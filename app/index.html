<!DOCTYPE html>
<html ng-app="realestateApp">
  <head>
    <meta charset="UTF-8">
    <title>Yes Residential Real Estate Updater App</title>

    <link rel="stylesheet" href="./vendor/mdl/material.min.css">
    <link rel="stylesheet" href="./vendor/mdl/material-icons.css">
    <link rel="stylesheet" href="./node_modules/angular/angular-csp.css">
    <link rel="stylesheet" href="./css/style.css">
  </head>
  <body ng-controller="RealEstateCtrl">
    <!-- Simple header with fixed tabs. -->
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
                mdl-layout--fixed-tabs mdl-layout--no-drawer-button">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <div class="mdl-layout-icon"><i class="material-icons">home</i> &nbsp;</div>
          <span class="mdl-layout-title">Yes Residential Real Estate Updater App</span>
        </div>
        <!-- Tabs -->
        <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
          <span class="mdl-layout__tab tab-auth" ng-class="{'is-active': appState === AppStates.AUTH}">Authenticate</span>
          <span class="mdl-layout__tab tab-select" ng-class="{'is-active': appState === AppStates.SELECTION}">Select Sheet</span>
          <span class="mdl-layout__tab tab-update" ng-class="{'is-active': appState === AppStates.UPDATE}">Update Data</span>
        </div>
      </header>
      <main class="mdl-layout__content">
        <section class="mdl-layout__tab-panel tab-auth" ng-class="{'is-active': appState == AppStates.AUTH}">
          <div class="page-content">
            <div class="mdl-grid">
              <div class="mdl-cell mdl-cell--12-col">
                <div id="google-auth" class="demo-card-wide mdl-card mdl-shadow--2dp">
                  <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text">Authenticate with Google Drive</h2>
                  </div>
                  <div class="mdl-card__supporting-text">
                    <p>You need to authenticate with the Google Drive for the software
                    to access your Google Drive based spreadsheets.</p>
                  </div>
                  <div class="mdl-card__actions mdl-card--border">
                    <div class="action-container" ng-hide="waiting">
                      <a id="start-auth" class="mdl-button mdl-button--raised mdl-js-button mdl-js-ripple-effect"
                          ng-click="startAuth()">
                        Authenticate
                      </a>
                    </div>
                    <div class="wait-container" ng-show="waiting">
                      <p>Authenticating and fetching your Google Spreadsheets...</p>
                      <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="mdl-layout__tab-panel tab-select" ng-class="{'is-active': appState === AppStates.SELECTION}">
          <div class="page-content">
            <div class="mdl-grid">
              <div class="mdl-cell mdl-cell--12-col">
                <div id="google-sheet" class="demo-card-wide mdl-card mdl-shadow--2dp">
                  <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text">Select the Google Sheet</h2>
                  </div>
                  <div class="mdl-card__supporting-text">
                    <p>You need to select the Google spreadheet to be used as
                    destinantion for property updates.</p>
                  </div>
                  <div class="mdl-card__actions mdl-card--border">
                    <ul id="sheets" class="demo-list-icon mdl-list">
                      <li class="mdl-list__item" ng-repeat="sheet in sheets">
                       <span class="mdl-list__item-primary-content">
                         <img src="./img/sheets.png" width="32px">
                         <span style="margin-left: 1em;">{{sheet.name}}</span>
                       </span>
                       <span class="mdl-list__item-secondary-action">
                         <button id="sheet-selector-{{$index}}"
                           class="mdl-button mdl-js-button mdl-button--icon">
                           <i class="material-icons">more_vert</i>
                         </button>
                         <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect"
                             for="sheet-selector-{{$index}}" id="sheet-menu-{{$index}}">
                             <li class="mdl-menu__item" ng-repeat="insheet in sheet.sheets"
                               ng-click="sheetSelected(sheet.id, sheet.name, insheet)">{{insheet}}</li>
                          </ul>
                       </span>
                     </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="mdl-layout__tab-panel tab-update" ng-class="{'is-active': appState === AppStates.UPDATE}">
          <div class="page-content">
            <div class="mdl-grid">
              <div class="mdl-cell mdl-cell--12-col">
                <div id="google-sheet" class="demo-card-wide mdl-card mdl-shadow--2dp">
                  <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text">Update the real estate data</h2>
                  </div>
                  <div class="mdl-card__supporting-text">
                    <p>Used spreadsheet: <img src="./img/sheets.png" width="16px"> {{ file_name }}</p>
                    <p>Select the e-mail to be used as a source for the real estate
                    data updates.</p>
                  </div>
                  <div class="mdl-card__actions mdl-card--border">
                    <div class="action-container" ng-hide="waiting">
                      <span id="estate-update" class="mdl-button mdl-button--raised mdl-js-button mdl-js-ripple-effect"
                            ng-click="selectMailAndUpdate()">
                        Choose mail and update real estate data
                      </span>
                    </div>
                    <div class="wait-container" ng-show="waiting">
                      <p>Reading your mail and updating Google Spreadsheet...</p>
                      <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      require('babel-register');
      require('babel-polyfill');

      window.$ = require('zepto-node')(window);
      require('./vendor/mdl/material.min.js')
      require('./js/app.js');
    </script>
  </body>
</html>
